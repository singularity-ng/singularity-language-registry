# direnv configuration for automatic Nix shell activation
# Install direnv: https://direnv.net/

# Stricter bash settings
set -euo pipefail

# Auto-reload when these files change
watch_file flake.nix
watch_file flake.lock
watch_file Cargo.toml
watch_file Cargo.lock
watch_file .envrc.local

# Use Nix flake for development environment
use flake

# Custom environment variables (matches CI settings)
export RUST_LOG=debug
export RUST_BACKTRACE=1
export CARGO_TERM_COLOR=always
export CARGO_INCREMENTAL=1  # Enable incremental compilation for local dev

# Performance: Use all CPU cores for builds
export CARGO_BUILD_JOBS=$(nproc 2>/dev/null || sysctl -n hw.ncpu 2>/dev/null || echo 4)

# Load local secrets if present (gitignored)
if [ -f .envrc.local ]; then
    source .envrc.local
    echo "ğŸ” Local secrets loaded from .envrc.local"
fi

# Announce activation
echo "ğŸ“¦ Nix development environment loaded"
echo "   Run 'nix flake check' to validate"