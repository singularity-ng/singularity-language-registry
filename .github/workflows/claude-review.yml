name: Claude Review Required

on:
  pull_request:
    types: [opened, synchronize]
    branches: [main]

jobs:
  require-claude-for-main:
    name: Require Claude Review for Main
    runs-on: ubuntu-latest
    steps:
      - name: Check for Claude review
        uses: actions/github-script@v7
        with:
          script: |
            const pr_number = context.payload.pull_request.number;

            // Check if Claude review has been completed
            const comments = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr_number
            });

            const has_claude_review = comments.data.some(comment =>
              comment.body.includes('Claude AI Review') ||
              comment.body.includes('Claude review completed') ||
              comment.body.includes('@claude') ||
              comment.author?.login === 'claude[bot]'
            );

            if (!has_claude_review) {
              core.setFailed('Claude review required for merging to main. Comment "@claude review" to trigger.');
            } else {
              console.log('Claude review found');
            }
