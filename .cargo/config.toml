[registries]
# GitHub Packages - Private registry using GitHub Enterprise
# Note: Use 'cargo login --registry github' to set token
github = { index = "sparse+https://github.com/Singularity-ng/_cargo-index/" }

[registry]
# Default registry (can override to use private)
default = "crates-io"  # Change to "github" for private-by-default

[net]
git-fetch-with-cli = true  # Use git CLI for auth (better for enterprise)
retry = 3

[build]
# Incremental compilation for local dev
incremental = true
jobs = 4  # Limit to 4 parallel jobs to prevent system overload

# Stricter type checking to match vectordrive CI environment
[target.'cfg(all())']
rustflags = [
    "-D", "warnings",              # Deny all warnings (treat as errors)
    "-W", "clippy::all",           # Enable all clippy warnings
    "-W", "clippy::pedantic",      # Pedantic clippy checks
]

# Use system GCC linker on x86_64 Linux to avoid Nix clang/vDSO issues
[target.x86_64-unknown-linux-gnu]
linker = "gcc"

# Use Clang/LLD for linking on AArch64 Linux (for LLVM Bitcode compatibility)
[target.aarch64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld"]

[profile.release]
lto = true
codegen-units = 1
opt-level = 3
